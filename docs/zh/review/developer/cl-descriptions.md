# 书写良好的CL描述



一个CL描述是一个公共记录，它记录着什么正在变更以及为什么会变更。它将成为我们版本控制历史中的永久部分，并且可能会被除近年来的审阅者之外的数百人阅读。

未来的开发人员将根据其描述搜索你的CL。未来的某个人可能正在查找你的更改，因为他有一点相关的记忆，但没有具体可得的细节。如果所有重要信息都在代码而不是描述中，那么让他们定位到你的CL会更加困难。

## 第一行 {#firstline}

*   关于正在做什么的一个简短摘要。
*   一个完整的句子，像是一条命令。
*   接着是一个空行。

CL描述的 **第一行** 应该是一个简短的总结，*明确* **哪些** 是由CL完成的，之后是一个空行。这是未来大多数代码搜索者在浏览一段代码的版本控制历史时会看到的内容，因此第一行应该提供足够的信息，让他们不必为了知道你的CL实际做了什么而去阅读你的整个CL或其整个描述。

按照传统，CL描述的第一行是一个完整的句子，就好像它是一条命令（一个祈使句）。例如，说“ **删除** FizzBu​​zz RPC并将其**替换**为新系统”。而不是“ **删除了** FizzBu​​zz RPC并将其**替换为了**新系统”。但是你不必将其余描述写为祈使句。

## 主体信息丰富 {#informative}

描述的其余部分应该是信息丰富的。它可能包括对正在解决的问题的简要描述，以及为什么这是最好的方法。如果这个方法有任何缺点，应该提到它们。如果相关的话，背景信息也得包含进来，例如错误编号，基准测试结果以及设计文档的链接。

即使是小型CL也需要注意细节。把CL放在上下文背景信息中。

## 不良的CL描述 {#bad}

“修复bug”是一个不够充分的CL描述。什么bug？你做了什么修复了它？其他类似的不良描述包括：

-   “修复构建。”
-   “添加补丁。”
-   “将代码从A移动到B.”
-   “阶段1。”
-   “添加便利功能。”
-   “除去奇怪的链接。”

其中一些是真实的CL描述。他们的作者可能认为他们提供了有用的信息，但他们并没有达到CL描述的目的。

## 良好的CL描述 {#good}

以下是一些良好的CL描述示例。

### 功能改变

> rpc：删除RPC服务器消息freelist上的大小限制。
> 
> 像FizzBu​​zz这样的服务器有非常大的消息量，复用可以从中受益。
> 使freelist更大，添加一个goroutine，根据时间的推移缓慢释放freelist条目，以便空闲服务器最终释放所有freelist条目。

前几个词描述了CL实际上做了什么。其余的描述讨论了正在解决的问题，为什么这是一个很好的解决方案，以及有关具体实现的更多信息。

### 重构

> 使用TimeKeeper来构造一个任务以使用其TimeStr和Now方法。
> 
> 向任务添加一个Now方法，这样就可以删除borglet()getter方法（只有OOMCandidate用它来调用borglet的Now方法）。这取代了委托给TimeKeeper的Borglet上的方法。
> 
> 允许任务提供NOW方法是消除对Borglet的依赖的一个步骤。最终，依赖于从任务中获取Now的协作者应该被更改为直接使用TimeKeeper，但这可以通过小步骤进行重构。
> 
> 继续重构Borglet层次结构的长期目标。

第一行描述了CL的作用以及这是如何更改的。其余的描述讨论了具体的实现，CL的背景，解决方案的不理想，以及未来可能的方向。它还解释了*为什么*要做出这种改变。

### 小CL需要一些背景信息

> 为status.py创建一个Python3构建规则。
> 
> 这允许已经在Python3中使用它的消费者依赖于原始构建规则过渡到新的规则，而不是在他们自己的理解下处理。它鼓励新的消费者使用Python3而不是Python2，并且着重简化了当前正在使用的一些自动构建文件重构工具。

第一句话描述了实际做了什么。其余的描述解释了*为什么*要进行更改并为审查者提供了大量背景信息。

## 在提交CL之前查看描述

CLs在审核期间可能会发生重大变化。在提交CL之前检查CL描述是值得的，以确保描述仍然反映了CL的作用。

下一篇：[小型CLs](small-cls.md)
